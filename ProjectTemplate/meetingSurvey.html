<!DOCTYPE html>
<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script type="text/javascript">

       var finalPoints = 0;

       function initialzeConnections() {
           var webMethod = "ProjectServices.asmx/getMeetingsNoResponse";
           var meetingSelector = document.getElementById('meetingSelectID');

           $.ajax({
               type: "POST",
               url: webMethod,
               contentType: "application/json; charset=utf-8",
               dataType: "json",
               success: function (msg) {
                   let jsonObjs = JSON.parse(msg.d);
                   for (let i = 0; i < jsonObjs.length; i++) {
                       optionElement = document.createElement('option');
                       optionElement.value = jsonObjs[i].username;
                       optionElement.id = jsonObjs[i].meetingID;
                       optionElement.innerText = `Meeting with ${jsonObjs[i].firstName} ${jsonObjs[i].lastName} on ${ jsonObjs[i].date }`;
                       meetingSelector.appendChild(optionElement);
                   }
               },
               error: function (e) {
                   alert("Issue!");
               }
           });

       }

       function parseMeetingSurvey(meeting_id, subject_username, meetingNotes, rating, effectiveness, learn, didBenefit, time) {
           var webMethod = "ProjectServices.asmx/parseMeetingSurvey";
           var parameters = "{\"meetingID\":\"" + encodeURI(meeting_id) + "\",\"subjectUsername\":\"" + encodeURI(subject_username) +
               "\",\"meetingNotes\":\"" + encodeURI(meetingNotes) + "\",\"rating\":\"" + encodeURI(rating) +
               "\",\"effectiveness\":\"" + encodeURI(effectiveness) + "\",\"didLearn\":\"" + encodeURI(learn) +
               "\",\"didBenefit\":\"" + encodeURI(didBenefit) + "\",\"meetingLength\":\"" + encodeURI(time) + "\",\"finalPoints\":\"" + encodeURI(finalPoints) + "\"}";

           
           $.ajax({
               type: "POST",
               url: webMethod,
               data: parameters,
               contentType: "application/json; charset=utf-8",
               dataType: "json",
               success: function (msg) {
                   if (msg.d) {
                       alert("Your responses have been recorded. Thank you for your feedback.");
                       window.location.reload();
                   }
                   else {
                       alert("error")
                   }
               },
               error: function (e) {
                   alert("Issue!");
               }
           });
       }

       /* Parse Survey and output User Info */
       function calcPoints() {
       
           console.log('triggered')
           var initialPoints = 10;

           ratingSelection = $(".radioButtons1:checked").val();
           effectiveness = $(".radioButtons2:checked").val();
           learn = $(".radioButtons3:checked").val();
           benefit = $(".radioButtons4:checked").val();
           time = $(".radioButtons5:checked").val();

           var surveyPointsDict = {
               "1": 1,
               "2": 1,
               "3": 1.5,
               "4": 1.5,
               "5": 2,
               "6": 2,
               "7": 2.5,
               "8": 2.5,
               "9": 2.5,
               "10": 3,

           };

           var effectivenessDict = {
               "1": 5,
               "0": 0,
           };

           var learnDict = {
               "1": 5,
               "0": 0,
           };

           var benefitDict = {
               "1": 5,
               "0": 0,
           };

           var timeDict = {
               "15": 1,
               "30": 2.5,
               "45": 3,
               "60": 5,
           };


           //calculator
           console.log('ratingSelection:' + ratingSelection);
           console.log('effectiveness:' + effectiveness);
           console.log('learn:' + learn);
           console.log('time:' + time);
           console.log('benefit:' + benefit);

           finalPoints = Math.round((initialPoints * surveyPointsDict[ratingSelection]) + effectivenessDict[effectiveness] + learnDict[learn] + benefitDict[benefit] + timeDict[time]);         
           console.log('final points:' + finalPoints);
       }
	</script> 


    <link rel="stylesheet" type="text/css" href="survey_styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="script.js"></script>
</head>


<body onload="initialzeConnections()" id="bodyID">

    <!-- <div class="nav">
        <a href="index.html"><i class="fa fa-fw fa-home"></i> Home</a>
        <a href="survey.html"><i class="fa fa-fw fa-pencil-square-o"></i>Survey</a>
    </div> -->

 <!-- Survey questions form -->

    <div id="formDiv" class="survey-container">
        <div class="nav">
            <a href="index.html"><i class="fa fa-fw fa-home"></i> Home</a>
            <a href="survey.html"><i class="fa fa-fw fa-pencil-square-o"></i>Survey</a>
        </div>
        <div id="white-background">
            <h1 id="filloutSurvey">POST-MEETING SURVEY</h1>
            <div id="mainDiv" class="survey-body">
                <div id="calculator" style="text-align: right;">

                </div>
                <form onsubmit="parseMeetingSurvey($('#meetingSelectID').find('option:selected').attr('id'), $('#meetingSelectID').val(), $('#meetingNotes').val(), $('.radioButtons1:checked').val(), $('.radioButtons2:checked').val(), $('.radioButtons3:checked').val(), $('.radioButtons4:checked').val(), $('.radioButtons5:checked').val()); return false;">
                    <br>
                    <label for="meetingSelectID" class="questions">Select the meeting you are filling out the survey for.</label>
                    <select id="meetingSelectID" required>
                        <option value="" disabled selected>Select a Meeting</option>
                    </select><br><br>


                    <label class="questions">Please input a brief summary of your meeting.</label><br>
                    <textarea class="inputBox" id="meetingNotes" rows="10" cols="62" required></textarea><br><br>

                    <label class="questions">How would you rate this meeting on a scale of 1-10?</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceOne" name="ratingSelection" value="1" required>
                    <label class="ratingLabels" for="typeChoiceOne">1</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceTwo" name="ratingSelection" value="2">
                    <label class="ratingLabels" for="typeChoiceTwo">2</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceThree" name="ratingSelection" value="3">
                    <label class="ratingLabels" for="typeChoiceThree">3</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceFour" name="ratingSelection" value="4">
                    <label class="ratingLabels" for="typeChoiceFour">4</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratinfChoiceFive" name="ratingSelection" value="5">
                    <label class="ratingLabels" for="typeChoiceFive">5</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceSix" name="ratingSelection" value="6">
                    <label class="ratingLabels" for="typeChoiceSix">6</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceSeven" name="ratingSelection" value="7">
                    <label class="ratingLabels" for="typeChoiceSeven">7</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceEight" name="ratingSelection" value="8">
                    <label class="ratingLabels" for="typeChoiceEight">8</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceNine" name="ratingSelection" value="9">
                    <label class="ratingLabels" for="typeChoiceNine">9</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons1" type="radio" id="ratingChoiceTen" name="ratingSelection" value="10">
                    <label class="ratingLabels" for="typeChoiceTen">10</label><br>

                    <label class="questions">Do you feel this meeting was effective for both of you?</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons2" type="radio" id="effectivenessTrue" name="effectivenessBool" value="1" required>
                    <label class="effectivenessLabels" for="effectivenessTrue">True</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons2" type="radio" id="effectivenessFalse" name="effectivenessBool" value="0" required>
                    <label class="effectivenessLabels" for="effectivenessFalse">False</label><br>

                    <label class="questions">Did you learn anything new or useful from your meeting?</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons3" type="radio" id="learnTrue" name="learnBool" value="1" required>
                    <label class="learnLabels" for="learnTrue">True</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons3" type="radio" id="learnFalse" name="learnBool" value="0" required>
                    <label class="learnLabels" for="learnFalse">False</label><br>

                    <label class="questions">Do you feel your mentoring relationship is mutually beneficial?</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons4" type="radio" id="benefitTrue" name="benefitBool" value="1" required>
                    <label class="benefitLabels" for="benefitTrue">True</label><br>

                    <input onchange="calcPoints()" class="radioButtons radioButtons4" type="radio" id="benefitFalse" name="benefitBool" value="0" required>
                    <label class="benefitLabels" for="benefitFalse">False</label><br>

                    <label class="questions">Approximately how long was your meeting?</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons5" type="radio" id="timeOne" name="timeSelection" value="15" required>
                    <label class="timeLabels" for="timeChoiceOne">15 Minutes</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons5" type="radio" id="timeTwo" name="timeSelection" value="30" required>
                    <label class="timeLabels" for="timeChoiceOne">30 Minutes</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons5" type="radio" id="timeThree" name="timeSelection" value="45" required>
                    <label class="timeLabels" for="timeChoiceOne">45 Minutes</label><br>
                    <input onchange="calcPoints()" class="radioButtons radioButtons5" type="radio" id="timeFour" name="timeSelection" value="60" required>
                    <label class="timeLabels" for="timeChoiceOne">1 Hour</label><br>


                    <input id="Signup" class="inputBox" type="submit" value="Submit">

                </form>
            </div>
        </div>
    </div>

</body>
</html>